<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Teleza Reeves — GEMS Quiz</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      /* Brand palette */
      --bg:#07060a;
      --bg-card:#121017;
      --fg:#ffffff;
      --muted:#c9c4d4;

      --brand:#a78bfa;       /* lavender */
      --brand-soft:#f9a8d4;  /* blush */
      --border:rgba(255,255,255,.14);

      /* gem colors */
      --sapphire:#2bb3ff;
      --ruby:#ff3b3b;
      --pearl:#ffd7f2;
      --emerald:#30d985;
    }

    *{box-sizing:border-box}
    html,body{
      margin:0; padding:0;
      background: radial-gradient(circle at top, #1a1224 0, var(--bg) 60%);
      color:var(--fg);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }
    body{min-height:100vh;display:flex;flex-direction:column}

    header{
      padding:20px 16px 14px;
      border-bottom:1px solid rgba(255,255,255,0.10);
      text-align:center;
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(12px);
      background: linear-gradient(to bottom, rgba(7,6,10,0.95), rgba(7,6,10,0.82));
    }
    .brand{
      font-weight:900;
      font-size:14px;
      letter-spacing:1.4px;
      text-transform:uppercase;
      background:linear-gradient(90deg,var(--brand),var(--brand-soft));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    h1{margin:4px 0 4px;font-size:clamp(22px,5vw,30px)}
    .sub{color:var(--muted);font-size:13px}

    .wrap{
      max-width:960px;
      margin:0 auto;
      padding:16px;
      padding-bottom:60px;
      width:100%;
    }

    .card{
      background:var(--bg-card);
      border-radius:18px;
      border:1px solid var(--border);
      padding:16px 14px;
      margin-bottom:12px;
      box-shadow:0 14px 40px rgba(0,0,0,.45);
    }
    .card--glow{
      border:1px solid rgba(167,139,250,.55);
      box-shadow:0 0 26px rgba(249,168,212,.12);
    }

    .meta{color:var(--muted);font-size:13px;line-height:1.45}
    .q{font-weight:800;margin-bottom:10px;font-size:15px}
    .answers{display:grid;gap:8px}

    .answer{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.18);
      background:linear-gradient(90deg, rgba(255,255,255,0.04), rgba(0,0,0,0.42));
      cursor:pointer;
      font-size:14px;
      transition: border-color .15s ease, background .15s ease, transform .08s ease;
      -webkit-tap-highlight-color:transparent;
      user-select:none;
    }
    .answer input{accent-color:var(--brand);transform:scale(1.1)}
    .answer:hover{border-color:rgba(249,168,212,0.85)}
    .answer.selected{
      border-color:rgba(167,139,250,.95);
      background:radial-gradient(circle at left, rgba(167,139,250,0.20), rgba(0,0,0,0.65));
      transform:translateY(-1px);
    }

    .buttons{display:flex;gap:8px;flex-wrap:wrap;margin:14px 0 4px}
    button{
      border-radius:999px;border:none;
      padding:9px 18px;
      font-weight:900;
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:.5px;
      cursor:pointer;
    }
    .btn-primary{
      background:linear-gradient(90deg,var(--brand),var(--brand-soft));
      color:#0f0b17;
    }
    .btn-secondary{
      background:transparent;
      color:var(--fg);
      border:1px solid rgba(255,255,255,0.28);
    }
    button:disabled{opacity:.45;cursor:not-allowed}

    .progress-shell{margin:10px 0 14px;font-size:12px;color:var(--muted)}
    .progress-label-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .progress-bar{width:100%;height:7px;border-radius:999px;background:rgba(255,255,255,0.07);overflow:hidden}
    .progress-fill{height:100%;width:0;border-radius:999px;background:linear-gradient(90deg,var(--brand),var(--brand-soft));transition:width .18s ease-out}

    .quiz-layout{display:grid;grid-template-columns:minmax(0,1fr);gap:12px}
    @media (min-width:800px){
      .quiz-layout{grid-template-columns:minmax(0,1.4fr) minmax(0,1fr)}
    }

    .result{
      padding:14px 14px 16px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.16);
      background:radial-gradient(circle at top left, rgba(167,139,250,0.14), #0b0a10);
      display:none;
    }
    .result-title{font-size:18px;font-weight:900;margin-bottom:4px}

    .pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 9px;border-radius:999px;
      border:1px solid rgba(255,255,255,0.24);
      font-size:11px;text-transform:uppercase;letter-spacing:.5px;
      margin-bottom:6px;
    }
    .dot{width:10px;height:10px;border-radius:999px;background:var(--brand)}

    .bars{margin-top:8px;display:grid;gap:8px}
    .bar-row{display:flex;align-items:center;gap:8px;font-size:13px}
    .bar-label{width:80px;text-transform:uppercase;font-weight:800;font-size:11px}
    .bar-shell{flex:1;height:14px;border-radius:999px;background:rgba(255,255,255,0.06);overflow:hidden}
    .bar-fill{height:100%;width:0;border-radius:999px}
    .bar-val{width:42px;text-align:right;font-weight:900;font-size:12px}

    .section-title{margin-top:10px;font-size:14px;font-weight:900}
    .bullets{margin:4px 0 0;padding-left:18px;font-size:13px;color:var(--muted)}
    .bullets li{margin-bottom:3px}

    .profile-tools{margin-top:10px;display:none}
    .profile-row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:8px}
    .profile-tools input[type="text"]{
      background:#0b0b12;border-radius:10px;
      border:1px solid rgba(255,255,255,0.2);
      padding:8px 9px;font-size:13px;color:var(--fg);
      min-width:180px;
    }
    .profile-tools input[type="file"]{font-size:12px;color:var(--muted)}
    .preview{margin-top:10px;border-radius:16px;border:1px dashed rgba(255,255,255,0.24);background:#05050a;padding:8px;text-align:center}
    .preview img{max-width:100%;border-radius:14px;display:block;margin:0 auto}

    .footer{
      text-align:center;font-size:11px;color:var(--muted);
      padding:10px 16px 18px;margin-top:auto;opacity:.85;
    }
    .badge-legal{
      font-size:10px;text-transform:uppercase;letter-spacing:.5px;
      border-radius:999px;border:1px solid rgba(255,255,255,0.2);
      padding:2px 6px;display:inline-block;margin-bottom:4px;
    }
  </style>
</head>

<body>
<header>
  <div class="brand">Teleza Reeves</div>
  <h1>GEMS Personality Quiz</h1>
  <div class="sub">Discover your dominant money-making personality: Sapphire • Ruby • Pearl • Emerald</div>
</header>

<div class="wrap">
  <div class="card card--glow">
    <div class="meta">
      This quiz is created by Teleza Reeves — to help you understand how you naturally move in money,
      business, and community. Choose the answer that sounds most like you <b>most of the time</b>.
    </div>
  </div>

  <div class="quiz-layout">
    <div>
      <div class="card">
        <div class="progress-shell">
          <div class="progress-label-row">
            <span id="progressText">Question 1 of 1</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        </div>

        <div id="questionContainer"></div>

        <div class="buttons">
          <button class="btn-secondary" id="prevBtn" type="button">Back</button>
          <button class="btn-primary" id="nextBtn" type="button">Next</button>
        </div>
      </div>
    </div>

    <div>
      <div id="resultPanel" class="result"></div>

      <div class="profile-tools" id="profileTools">
        <div class="card">
          <div class="q">Generate your share card</div>
          <div class="meta" style="margin-bottom:6px;">
            Perfect for Instagram / TikTok — 1080×1350 portrait. Add your name and optional photo, then download as PNG.
          </div>

          <div class="profile-row">
            <input type="text" id="displayName" placeholder="Your name (optional)" />
            <input type="text" id="brandTag" placeholder="@handle or tagline (optional)" />
            <input type="file" id="photoInput" accept="image/*" />
            <button class="btn-primary" id="makeCard" type="button">Generate My Share Card</button>
          </div>

          <div class="profile-row">
            <button class="btn-secondary" id="downloadCard" type="button" style="display:none;">Download PNG</button>
          </div>

          <div class="preview" id="cardPreview" style="display:none;">
            <img id="cardImg" alt="Share card preview" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <span class="badge-legal">For personal insight only</span><br />
    Not medical, legal, or financial advice. © Teleza Reeves
  </div>
</div>

<script>
/* --------------------------
   CONFIG
-------------------------- */
const BRAND = {
  name: "TELEZA REEVES",
  tagline: "GEMS Personality • Teleza Reeves",
  font: "system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"
};

const GEMS = {
  sapphire: {
    label: "Sapphire",
    colorVar: "--sapphire",
    description: "People-oriented • Active • Magnetic. You bring the fun, the story, and the vibe.",
    benefits: [
      "You attract people and attention effortlessly.",
      "You make experiences feel fun and memorable.",
      "You’re a natural storyteller and promoter."
    ],
    challenges: [
      "Finishing what you start when excitement wears off.",
      "Avoiding over-committing to too many ideas."
    ],
    tips: [
      "Batch content on high-energy days and schedule it.",
      "Use timers and short sprints for boring tasks."
    ],
    howToWin: [
      "Lead from the front with energy — host lives, events, and launches.",
      "Build a simple content ecosystem around your face, story, and lifestyle.",
      "Collaborate with structured teammates so ideas become assets.",
      "Protect your energy with boundaries; not every invite deserves your time.",
      "Turn your stories into offers: always give a next step."
    ]
  },
  ruby: {
    label: "Ruby",
    colorVar: "--ruby",
    description: "Task-oriented • Active • Competitive. You’re here to win, build, and scale.",
    benefits: [
      "You move fast and hate wasting time.",
      "You’re decisive when others hesitate.",
      "You’re comfortable talking about money and results."
    ],
    challenges: [
      "Impatience with slower or more sensitive people.",
      "Pushing so hard you ignore your own recovery."
    ],
    tips: [
      "Use visible scoreboards for goals (income, sales, recruits).",
      "Schedule non-negotiable rest to protect performance."
    ],
    howToWin: [
      "Set bold but clear money goals with real timelines.",
      "Design weekly power hours focused on revenue actions only.",
      "Track follow-ups and optimize your closing rate.",
      "Build assets (scripts, templates) so your ambition scales.",
      "Anchor your grind to a mission so it stays meaningful."
    ]
  },
  pearl: {
    label: "Pearl",
    colorVar: "--pearl",
    description: "People-oriented • Calm • Heart-led. You care deeply about impact, safety, and soul.",
    benefits: [
      "You make people feel safe, seen, and supported.",
      "You’re great at customer care and retention.",
      "You create spaces that feel like home and healing."
    ],
    challenges: [
      "Avoiding conflict even when boundaries are needed.",
      "Under-charging because you just want to help."
    ],
    tips: [
      "Write down your prices and boundaries so you don’t negotiate against yourself.",
      "Use scripts to invite people into your offers confidently."
    ],
    howToWin: [
      "Position yourself as the trusted guide in your space.",
      "Charge in alignment with the transformation you create.",
      "Systemize follow-up so you don’t carry it mentally.",
      "Set office hours and boundaries to protect your capacity.",
      "Use testimonials and stories to show the impact of your care."
    ]
  },
  emerald: {
    label: "Emerald",
    colorVar: "--emerald",
    description: "Task-oriented • Calm • Strategic. You see patterns, systems, and risk clearly.",
    benefits: [
      "You turn messy ideas into clear plans.",
      "You’re great with systems, tools, and dashboards.",
      "You build long-term foundations."
    ],
    challenges: [
      "Over-analyzing and delaying action.",
      "Waiting for perfect before moving."
    ],
    tips: [
      "Use 70% clarity as enough to move — don’t wait for perfect.",
      "Run small experiments to learn faster than theory."
    ],
    howToWin: [
      "Turn your organization into templates and frameworks others can use.",
      "Own operations: systems, finances, tech, quality control.",
      "Share your behind-the-scenes thinking — people will see it as genius.",
      "Protect deep-focus time for architecture and optimization.",
      "Document once so it can be reused many times."
    ]
  }
};

const QUESTIONS = [
  {
    text: "What gets you excited to start a new project?",
    options: {
      sapphire: "It sounds fun and I get to involve people.",
      ruby: "A clear challenge, competition, or prize to win.",
      pearl: "It helps or uplifts people I care about.",
      emerald: "There’s a plan, data, and a well-defined process."
    }
  },
  {
    text: "When making a decision, I usually…",
    options: {
      sapphire: "Go with my gut and keep the vibe positive.",
      ruby: "Choose quickly and move.",
      pearl: "Ask who will be affected and consider feelings.",
      emerald: "Weigh pros/cons and research first."
    }
  },
  {
    text: "My ideal work style looks like…",
    options: {
      sapphire: "Flexible, creative, and people-first.",
      ruby: "Fast paced, goal-driven, and results-focused.",
      pearl: "Supportive, collaborative, and service-oriented.",
      emerald: "Organized, detailed, and system-driven."
    }
  },
  {
    text: "When conflict shows up, I tend to…",
    options: {
      sapphire: "Lighten the mood and keep it moving.",
      ruby: "Address it head-on and resolve it fast.",
      pearl: "Seek harmony and listen to everyone.",
      emerald: "Collect facts and clarify misunderstandings."
    }
  },
  {
    text: "Your content naturally leans…",
    options: {
      sapphire: "Entertaining, high-energy, story-driven.",
      ruby: "Results and proof—wins, receipts.",
      pearl: "Encouraging, supportive, heart-centered.",
      emerald: "Breakdowns, how-to’s, and systems."
    }
  }
];

/* --------------------------
   QUIZ LOGIC
-------------------------- */
const questionContainer = document.getElementById("questionContainer");
const progressText = document.getElementById("progressText");
const progressPercent = document.getElementById("progressPercent");
const progressFill = document.getElementById("progressFill");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const resultPanel = document.getElementById("resultPanel");
const profileTools = document.getElementById("profileTools");

let currentIndex = 0;
const answers = {}; // { idx: "sapphire" | ... }

function answeredCount() {
  return Object.keys(answers).length;
}

function updateProgress() {
  const total = QUESTIONS.length;
  const answered = answeredCount();
  const pct = Math.round((answered / total) * 100);
  progressText.textContent = `Question ${currentIndex + 1} of ${total}`;
  progressPercent.textContent = `${pct}%`;
  progressFill.style.width = `${pct}%`;
}

function renderQuestion(idx) {
  const q = QUESTIONS[idx];
  if (!q) return;

  questionContainer.innerHTML = "";

  const qEl = document.createElement("div");
  qEl.className = "q";
  qEl.textContent = `Q${idx + 1}. ${q.text}`;
  questionContainer.appendChild(qEl);

  const answersWrap = document.createElement("div");
  answersWrap.className = "answers";

  ["sapphire","ruby","pearl","emerald"].forEach((key) => {
    const text = q.options[key];
    if (!text) return;

    const label = document.createElement("label");
    label.className = "answer";
    if (answers[idx] === key) label.classList.add("selected");

    const input = document.createElement("input");
    input.type = "radio";
    input.name = `q${idx}`;
    input.value = key;
    input.checked = answers[idx] === key;

    const span = document.createElement("span");
    span.textContent = text;

    label.appendChild(input);
    label.appendChild(span);

    label.addEventListener("click", () => {
      answers[idx] = key;
      answersWrap.querySelectorAll(".answer").forEach(a => a.classList.remove("selected"));
      label.classList.add("selected");
      updateProgress();
    });

    answersWrap.appendChild(label);
  });

  questionContainer.appendChild(answersWrap);

  prevBtn.disabled = idx === 0;
  nextBtn.textContent = idx === QUESTIONS.length - 1 ? "See My Results" : "Next";
  updateProgress();
}

function computeResults() {
  const counts = { sapphire:0, ruby:0, pearl:0, emerald:0 };
  for (let i=0;i<QUESTIONS.length;i++){
    const a = answers[i];
    if (a && counts[a] !== undefined) counts[a]++;
  }
  const total = Math.max(1, Object.values(counts).reduce((s,n)=>s+n,0));
  const pct = {};
  Object.keys(counts).forEach(k => pct[k] = Math.round((counts[k]/total)*100));
  const ranking = Object.entries(pct).sort((a,b)=>b[1]-a[1]);
  const topKey = ranking[0][0];
  return { counts, pct, ranking, topKey };
}

function gemColor(key){
  const v = GEMS[key]?.colorVar;
  if (!v) return "#fff";
  return getComputedStyle(document.documentElement).getPropertyValue(v).trim() || "#fff";
}

function renderResults(){
  const { pct, topKey } = computeResults();
  const gem = GEMS[topKey];

  const barsHTML = ["sapphire","ruby","pearl","emerald"].map(k => {
    const c = gemColor(k);
    const value = pct[k] || 0;
    return `
      <div class="bar-row">
        <div class="bar-label">${GEMS[k].label}</div>
        <div class="bar-shell">
          <div class="bar-fill" style="width:${value}%;background:linear-gradient(90deg, ${c}, rgba(255,255,255,0.28));"></div>
        </div>
        <div class="bar-val">${value}%</div>
      </div>
    `;
  }).join("");

  resultPanel.style.display = "block";
  resultPanel.innerHTML = `
    <div class="pill">
      <span class="dot" style="background:${gemColor(topKey)};"></span>
      TOP GEM: ${gem.label.toUpperCase()}
    </div>
    <div class="result-title">${gem.label} — ${gem.description}</div>

    <div class="section-title">Your GEMS Mix</div>
    <div class="bars">${barsHTML}</div>

    <div class="section-title">Your Natural Benefits</div>
    <ul class="bullets">${gem.benefits.map(x=>`<li>${x}</li>`).join("")}</ul>

    <div class="section-title">Growth Edges & Challenges</div>
    <ul class="bullets">${gem.challenges.map(x=>`<li>${x}</li>`).join("")}</ul>

    <div class="section-title">Practical Tips</div>
    <ul class="bullets">${gem.tips.map(x=>`<li>${x}</li>`).join("")}</ul>

    <div class="section-title">How to Win as a ${gem.label}</div>
    <ul class="bullets">${gem.howToWin.map(x=>`<li>${x}</li>`).join("")}</ul>

    <div class="buttons" style="margin-top:10px;">
      <button class="btn-primary" type="button" id="showShareCardBtn">Generate My Share Card</button>
    </div>
  `;

  document.getElementById("showShareCardBtn").addEventListener("click", () => {
    profileTools.style.display = "block";
    profileTools.scrollIntoView({ behavior:"smooth" });
  });
}

prevBtn.addEventListener("click", () => {
  if (currentIndex > 0) {
    currentIndex--;
    renderQuestion(currentIndex);
  }
});

nextBtn.addEventListener("click", () => {
  if (!answers[currentIndex]) {
    alert("Please select an answer for this question first.");
    return;
  }
  if (currentIndex < QUESTIONS.length - 1) {
    currentIndex++;
    renderQuestion(currentIndex);
  } else {
    if (answeredCount() < QUESTIONS.length) {
      alert("Please answer all questions to see your results.");
      return;
    }
    renderResults();
    resultPanel.scrollIntoView({ behavior:"smooth" });
  }
});

// Start
renderQuestion(currentIndex);

/* --------------------------
   SHARE CARD
-------------------------- */
let loadedPhoto = null;
const photoInput = document.getElementById("photoInput");
const makeCardBtn = document.getElementById("makeCard");
const downloadBtn = document.getElementById("downloadCard");
const cardPreview = document.getElementById("cardPreview");
const cardImg = document.getElementById("cardImg");

photoInput.addEventListener("change", (e) => {
  const file = e.target.files && e.target.files[0];
  if (!file) return;
  const img = new Image();
  img.onload = () => (loadedPhoto = img);
  img.src = URL.createObjectURL(file);
});

function roundRect(ctx, x, y, w, h, r){
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.lineTo(x+w-r, y);
  ctx.quadraticCurveTo(x+w, y, x+w, y+r);
  ctx.lineTo(x+w, y+h-r);
  ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
  ctx.lineTo(x+r, y+h);
  ctx.quadraticCurveTo(x, y+h, x, y+h-r);
  ctx.lineTo(x, y+r);
  ctx.quadraticCurveTo(x, y, x+r, y);
  ctx.closePath();
}

function wrapText(ctx, text, x, y, maxWidth, lineHeight){
  const words = (text || "").split(" ");
  let line = "";
  const lines = [];
  for (let i=0;i<words.length;i++){
    const test = line + words[i] + " ";
    if (ctx.measureText(test).width > maxWidth && i>0){
      lines.push(line.trim());
      line = words[i] + " ";
    } else {
      line = test;
    }
  }
  lines.push(line.trim());
  lines.forEach((ln, i) => ctx.fillText(ln, x, y + i*lineHeight));
  return y + (lines.length-1)*lineHeight;
}

function drawShareCard({pct, topKey}, photo){
  const gem = GEMS[topKey];

  const W = 1080;
  const H = 1350;
  const pad = 60;

  const canvas = document.createElement("canvas");
  canvas.width = W;
  canvas.height = H;
  const ctx = canvas.getContext("2d");

  // Background
  const bg = ctx.createLinearGradient(0,0,W,H);
  bg.addColorStop(0, "#1a1224");
  bg.addColorStop(1, "#07060a");
  ctx.fillStyle = bg;
  ctx.fillRect(0,0,W,H);

  const CX = pad, CY = pad;
  const CW = W - 2*pad, CH = H - 2*pad;

  // Inner card
  ctx.fillStyle = "rgba(0,0,0,0.66)";
  ctx.strokeStyle = "rgba(255,255,255,0.22)";
  ctx.lineWidth = 2;
  roundRect(ctx, CX, CY, CW, CH, 34);
  ctx.fill();
  ctx.stroke();

  // Header
  ctx.fillStyle = "#fff";
  ctx.font = `900 52px ${BRAND.font}`;
  ctx.fillText(BRAND.name, CX + 40, CY + 80);

  ctx.font = `800 34px ${BRAND.font}`;
  ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue("--brand-soft").trim() || "#f9a8d4";
  ctx.fillText(`TOP GEM: ${gem.label}`.toUpperCase(), CX + 40, CY + 130);

  // Photo circle (with safe breathing room)
  const P = 220;
  const pX = CX + CW - P - 44; // extra spacing
  const pY = CY + 44;

  ctx.save();
  ctx.beginPath();
  ctx.arc(pX + P/2, pY + P/2, P/2, 0, Math.PI*2);
  ctx.closePath();
  ctx.clip();
  ctx.fillStyle = "#23202a";
  ctx.fillRect(pX, pY, P, P);

  if (photo){
    const ar = photo.width / photo.height;
    let sx=0, sy=0, sw=photo.width, sh=photo.height;
    if (ar > 1){
      sw = photo.height;
      sx = (photo.width - sw)/2;
    } else {
      sh = photo.width;
      sy = (photo.height - sh)/2;
    }
    ctx.drawImage(photo, sx, sy, sw, sh, pX, pY, P, P);
  }
  ctx.restore();

  // Photo ring
  ctx.strokeStyle = "rgba(255,255,255,0.38)";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.arc(pX + P/2, pY + P/2, P/2, 0, Math.PI*2);
  ctx.stroke();

  // Mix bars (NEVER overlap photo)
  let y = CY + 210;
  ctx.fillStyle = "#fff";
  ctx.font = `900 32px ${BRAND.font}`;
  ctx.fillText("YOUR GEMS MIX", CX + 40, y);

  const startX = CX + 40;
  const labelW = 160;
  const barX = startX + labelW;

  // The bar area must stop before the photo starts
  const safeRightEdge = pX - 28; // gap before photo
  const barW = Math.max(240, safeRightEdge - barX);
  const barH = 24;

  const order = ["sapphire","ruby","pearl","emerald"];

  y += 22;
  order.forEach((k) => {
    y += 52;

    const lab = GEMS[k].label;
    const value = pct[k] || 0;

    ctx.font = `700 24px ${BRAND.font}`;
    ctx.fillStyle = "#e6e6e6";
    ctx.fillText(lab, startX, y);

    // Shell
    ctx.fillStyle = "rgba(255,255,255,0.08)";
    roundRect(ctx, barX, y - 22, barW, barH, 12);
    ctx.fill();

    // Fill
    const w = Math.max(6, Math.round((barW * value) / 100));
    const c = gemColor(k);
    const g = ctx.createLinearGradient(barX, y - 22, barX + w, y - 22);
    g.addColorStop(0, c);
    g.addColorStop(1, "rgba(255,255,255,0.34)");
    ctx.fillStyle = g;
    roundRect(ctx, barX, y - 22, w, barH, 12);
    ctx.fill();

    // Percent text aligned INSIDE safe zone, right-aligned
    ctx.font = `900 22px ${BRAND.font}`;
    ctx.fillStyle = "#ffffff";
    ctx.textAlign = "right";
    ctx.fillText(value + "%", safeRightEdge, y - 2);
    ctx.textAlign = "left";
  });

  // How to win (MULTI tips on share card)
  y += 70;
  ctx.font = `900 30px ${BRAND.font}`;
  ctx.fillStyle = "#ffffff";
  ctx.fillText(`HOW TO WIN AS A ${gem.label.toUpperCase()}`, CX + 40, y);

  // 4 bullet tips with wrapping
  y += 18;
  ctx.font = `500 22px ${BRAND.font}`;
  ctx.fillStyle = "#dcd7e6";
  const tips = (gem.howToWin || []).slice(0, 4);
  const maxW = CW - 80;
  let tipY = y + 22;

  tips.forEach((t) => {
    tipY = wrapText(ctx, "• " + t, CX + 40, tipY, maxW, 30) + 14;
  });

  // Bottom name + brandTag (NO overlap + clean spacing)
  const nameVal = (document.getElementById("displayName").value || "").trim();
  const tagVal  = (document.getElementById("brandTag").value || "").trim();

  // reserve bottom area
  const nameBaseY = H - 170;

  if (nameVal){
    ctx.font = `900 34px ${BRAND.font}`;
    ctx.fillStyle = "#ffffff";
    ctx.fillText(nameVal, CX + 40, nameBaseY);
  }

  if (tagVal){
    ctx.font = `700 24px ${BRAND.font}`;
    ctx.fillStyle = "#cfc9dd";
    ctx.fillText(tagVal, CX + 40, nameBaseY + 34);
  }

  // Divider + brand line (always below name/tag)
  const dividerY = H - 78;
  const brandColor = getComputedStyle(document.documentElement).getPropertyValue("--brand").trim() || "#a78bfa";
  ctx.strokeStyle = brandColor;
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(CX + 40, dividerY);
  ctx.lineTo(CX + CW - 40, dividerY);
  ctx.stroke();

  ctx.font = `900 22px ${BRAND.font}`;
  ctx.fillStyle = brandColor;
  ctx.fillText(BRAND.tagline.toUpperCase(), CX + 40, dividerY - 14);

  return canvas;
}

makeCardBtn.addEventListener("click", () => {
  // Guard: must have results first
  if (answeredCount() < QUESTIONS.length){
    alert("Answer all questions first, then generate your share card.");
    return;
  }

  const { pct, topKey } = computeResults();
  const canvas = drawShareCard({ pct, topKey }, loadedPhoto);
  const url = canvas.toDataURL("image/png");

  cardImg.src = url;
  cardPreview.style.display = "block";
  downloadBtn.style.display = "inline-block";

  downloadBtn.onclick = () => {
    const a = document.createElement("a");
    a.href = url;
    a.download = "teleza-reeves-gems-card.png";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  };
});
</script>
</body>
</html>
